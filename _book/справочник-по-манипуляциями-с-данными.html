<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Глава 2 Справочник по манипуляциями с данными | Курс статистики для биохимиков</title>
  <meta name="description" content="Черновая версия учебника." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Глава 2 Справочник по манипуляциями с данными | Курс статистики для биохимиков" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Черновая версия учебника." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Глава 2 Справочник по манипуляциями с данными | Курс статистики для биохимиков" />
  
  <meta name="twitter:description" content="Черновая версия учебника." />
  

<meta name="author" content="АЕП" />


<meta name="date" content="2019-12-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Курс статистики для биохимиков</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Что я хочу видеть в данной книге?</a></li>
<li class="chapter" data-level="2" data-path="справочник-по-манипуляциями-с-данными.html"><a href="справочник-по-манипуляциями-с-данными.html"><i class="fa fa-check"></i><b>2</b> Справочник по манипуляциями с данными</a><ul>
<li class="chapter" data-level="2.1" data-path="справочник-по-манипуляциями-с-данными.html"><a href="справочник-по-манипуляциями-с-данными.html#план"><i class="fa fa-check"></i><b>2.1</b> План</a></li>
<li class="chapter" data-level="2.2" data-path="справочник-по-манипуляциями-с-данными.html"><a href="справочник-по-манипуляциями-с-данными.html#папки-и-проекты"><i class="fa fa-check"></i><b>2.2</b> Папки и проекты</a><ul>
<li class="chapter" data-level="2.2.1" data-path="справочник-по-манипуляциями-с-данными.html"><a href="справочник-по-манипуляциями-с-данными.html#работа-с-папками"><i class="fa fa-check"></i><b>2.2.1</b> Работа с папками</a></li>
<li class="chapter" data-level="2.2.2" data-path="справочник-по-манипуляциями-с-данными.html"><a href="справочник-по-манипуляциями-с-данными.html#работа-с-проектами"><i class="fa fa-check"></i><b>2.2.2</b> Работа с проектами</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="справочник-по-манипуляциями-с-данными.html"><a href="справочник-по-манипуляциями-с-данными.html#импорт"><i class="fa fa-check"></i><b>2.3</b> Импорт</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Сделано с помощью bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Курс статистики для биохимиков</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="справочник-по-манипуляциями-с-данными" class="section level1">
<h1><span class="header-section-number">Глава 2</span> Справочник по манипуляциями с данными</h1>
<div id="план" class="section level2">
<h2><span class="header-section-number">2.1</span> План</h2>
<ul>
<li>проекты</li>
<li>импорт - комманды
<ul>
<li>rio::import</li>
<li>read.table, read_xslx, read_csv …</li>
</ul></li>
<li>манипуляции с данными (все с реальными примерами!)
<ul>
<li>проверка типов данных</li>
<li>десятичные разделители</li>
<li>ошибки, строковые преобразования</li>
<li>выбросы - ошибки непрерывных переменных =&gt; график и исправить</li>
<li>категориальные переменные - уникальные значения и опечатки, регистры</li>
<li>пропущенные данные</li>
</ul></li>
<li>преобразования данных и пайплайны
<ul>
<li>типы пайплайнов
<ul>
<li>100 %&gt;% sqrt() %&gt;% log()</li>
<li>x = 100 %&gt;% sqrt() %&gt;% log()</li>
<li>x &lt;- 100 %&gt;% sqrt() %&gt;% log()</li>
<li>100 %&gt;% sqrt() %&gt;% log() -&gt; x</li>
</ul></li>
<li>=/&lt;-/-&gt;/%&gt;%/%&lt;&gt;%/%$%, select, rename, mutate, filter, group_by, summarise, pull/pluck, stack, rerun, extrac_grid, *join, str*, regex, rstatix, naniar, tidy(…), augment, {.}</li>
<li>pivot*</li>
<li>nest/unnest/map*/.x</li>
<li>ggplot</li>
</ul></li>
</ul>
</div>
<div id="папки-и-проекты" class="section level2">
<h2><span class="header-section-number">2.2</span> Папки и проекты</h2>
<p>Для удобства работы над каким-то проектом (например, обучение работы в <code>R</code> на наших занятиях) удобно завести под это специальную папку и держать в ней все файлы.</p>
<div id="работа-с-папками" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Работа с папками</h3>
<p>Чтобы <code>R</code> знал, в какой папке искать файлы, можно один раз задать базовую папку командой <code>setwd(&quot;C:/Path/to/my folder&quot;)</code>, либо при каждом обращении к файлу указывать полный путь к файлу, например <code>import(&quot;C:/Path/to/my folder/my file.xlsx&quot;)</code> (внимание, даже в Windows используем прямой слэш - “/”!). Однако это не очень удобно, изменение имени папки черевато ошибками. Поэтому у счастливых пользователей <code>RStudio</code> есть возможность облегчить себе жизнь путем использованием проектов.</p>
</div>
<div id="работа-с-проектами" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Работа с проектами</h3>
<p>Для создания нового проекта нужно в меню открыть <code>File &gt; New Project &gt; New Directory &gt; New Project</code>, после чего нужно будет задать имя корневой папки для проектов (например, <code>C:/Users/ThatsMe/R/</code>) и имя папки для текущего проекта (например, <code>BiochemStatsCourse</code>), после чего нажать <code>Create Project</code>. После этого данная папка будет считаться базовой и можно будет дальнейшие файлы создавать в ней самой или ее подпапках. Если вы кинули файл <code>my file.xls</code> в подпапку <code>data</code>, то его можно будет прочитать командой <code>import(&quot;data/my file.xlsx&quot;)</code> (уже не нужно указывать полный путь к папке, который будет <code>C:/Users/ThatsMe/R/BiochemStatsCourse/data/my file.xlsx</code>).</p>
<p>Более подробно об этом можно почитать <a href="https://bookdown.org/ndphillips/YaRrr/projects-in-rstudio.html">здесь</a>, <a href="https://r4ds.had.co.nz/workflow-projects.html">здесь</a> или <a href="https://www.tidyverse.org/blog/2017/12/workflow-vs-script/">здесь</a>.</p>
</div>
</div>
<div id="импорт" class="section level2">
<h2><span class="header-section-number">2.3</span> Импорт</h2>
<p>Данные, которые мы можем анализировать могут быть созданы в какой угодно программе (Excel, другие статистические программы, софт различных приборов и т.д.). Мы даже можем анализировать данные Web-страниц.</p>
<p>Самый частый в моей практике случай - использование файлов, созданных в Excel или экспортированных в этот формат. Наилучшим образом подходят для импорта в <code>R</code> форматы CSV и XSLX, однако можно научить <code>R</code> читать практически любой формат (кроме зашифрованных производителем).</p>
<p>Для примера скачаем тестовый файл по <a href="https://github.com/lapotok/biochemstat_book/blob/master/data/iris.xlsx?raw=true">ссылке</a> и сохраним его вручную в нужную папку.</p>
<blockquote>
<p>Однако это можно сделать и с помощью <code>R</code>. Для этого сначала сгенерируем имя временного файла и сохраним его в переменную tmp (или же вы можете прописать путь к папке и имя файла, если далее хотите с ним иметь дело), затем сохраним в него скачанный файл. После завершения работы скрипта временный файл будет удален, а если Вы сами указали путь и имя файла, тогда он останется.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># запишем в переменную имя файла</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">filename =<span class="st"> &quot;data/iris.xlsx&quot;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># скачиваем файл по ссылке</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">download.file</span>(<span class="st">&quot;https://github.com/lapotok/biochemstat_book/blob/master/data/iris.xlsx?raw=true&quot;</span>, filename)</a></code></pre></div>
</blockquote>
<p>Теперь этот файл можем открыть. Форматов бывает много, однако одна из наиболее продвинутых библиотек <code>rio</code> позволяет открывать практически любые распространенные форматы.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(rio)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(tidyverse))</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(magrittr))</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">my_iris =<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;data/iris.xlsx&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">my_iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : chr  &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; ...</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">my_iris<span class="op">$</span>Species <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()</a></code></pre></div>
<pre><code>## [1] &quot;setosa&quot;     &quot;versicolor&quot; &quot;virginica&quot;</code></pre>
<p>Видим, что файл открылся правильно, т.к.</p>
<ul>
<li>правильное число строк и столбцов</li>
<li>числовые переменные действительно имеют тип <code>num</code> (а не текстовый тип <code>chr</code> и не фактор <code>factor</code>)</li>
<li>в списке видов нет ничего лишнего, никаких ошибочно написанных</li>
</ul>
<p>Теперь для разнообразия откроем файл с ошибками.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#download.file(&quot;https://github.com/lapotok/biochemstat_book/blob/master/data/bad_data_example.xlsx?raw=true&quot;, &quot;data/bad_data_example.xlsx&quot;) </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">bad =<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;data/bad_data_example.xlsx&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">bad <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>() <span class="co"># смотрим на типы данных разных переменных</span></a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    38 obs. of  5 variables:
##  $ ID       : chr  &quot;PL01.It1&quot; &quot;PL01.It2&quot; &quot;PL01.It3&quot; &quot;PL01.It4&quot; ...
##  $ Weight   : chr  &quot;44&quot; &quot;99.2&quot; &quot;22&quot; &quot;67&quot; ...
##  $ Species  : chr  &quot;Genus1 species1&quot; &quot;Genus1 species1&quot; &quot;Genus1 species1&quot; &quot;Genus1 species2&quot; ...
##  $ Num ticks: num  203 0 70 0 197 0 125 229 138 218 ...
##  $ Пол      : chr  &quot;F&quot; &quot;M&quot; &quot;f&quot; &quot;m&quot; ...</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">bad<span class="op">$</span>Species <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>() <span class="co"># все ли названия правильные? нет ничего лишнего?</span></a></code></pre></div>
<pre><code>##  [1] &quot;Genus1 species1&quot;   &quot;Genus1 species2&quot;   &quot;Genus1 sp&quot;        
##  [4] &quot;Genus1 sp.&quot;        &quot;Genus1 spp.&quot;       &quot;NA&quot;               
##  [7] NA                  &quot;Genus2 hz&quot;         &quot;?&quot;                
## [10] &quot;Genus2 ?&quot;          &quot;Na&quot;                &quot;hz&quot;               
## [13] &quot;Genus2 species1 ?&quot; &quot;na&quot;                &quot;Genus2 species1&quot;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">bad<span class="op">$</span><span class="st">&quot;Пол&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>() <span class="co"># должно быть 2 пола или пропуск в данных, так ли это?</span></a></code></pre></div>
<pre><code>## [1] &quot;F&quot; &quot;M&quot; &quot;f&quot; &quot;m&quot; NA</code></pre>
<p>Какие могут быть ошибки в данных? В файле, который мы рассматриваем в качестве антипримера есть следующие ошибки</p>
<ul>
<li>неправильный десятичный разделитель в <code>Weight</code> и как следствие вся переменная определяется как строковая, а не численная</li>
<li>пропущенные данные, абы как названные (надо составить указания для <code>R</code> в формате регулярных выражений, что заменять на <code>NA</code> без кавычек - специальное обозначение для пропущенных данных)</li>
<li>русскоязычные названия переменных и названия с пробелами, что может вызывать неудобство в работе, например необходимость их закавычивать при обращении к ним (<code>bad$`Num ticks`</code>)</li>
<li>в колонке “Пол” буквы разного регистра обозначают одно и то же</li>
</ul>
<p>Какие-то из ошибок можно исправить уже на этапе подготовки данных (см. <a href="http://www.sthda.com/english/wiki/best-practices-in-preparing-data-files-for-importing-into-r">рекомендации</a>). Идеальная форма представления данных воплощается в концепте <a href="https://vita.had.co.nz/papers/tidy-data.pdf">“tidy data”</a>.</p>
<p>Учимся исправлять ошибки, которые мы уже научились находить.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">library</span>(naniar)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">good =<span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span>bad <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Weight =</span> <span class="kw">str_replace</span>(Weight, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;.&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># исправляем ошибку: заменяем , на .</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Weight =</span> <span class="kw">as.numeric</span>(Weight)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># теперь изменяем тип переменной на числовой</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Gender=</span><span class="st">`</span><span class="dt">Пол</span><span class="st">`</span>, <span class="dt">Num_ticks=</span><span class="st">`</span><span class="dt">Num ticks</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># переименовываем переменные, чтобы дальше было удобнее</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">  </span><span class="kw">replace_with_na_all</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_detect</span>(.x, <span class="kw">regex</span>(<span class="st">&quot;(^na$)|(.*hz.*)|(.*</span><span class="ch">\\</span><span class="st">?.*)&quot;</span>, <span class="dt">ignore_case =</span> T))) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># заменяем на NA (см. дальше)</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Gender =</span> <span class="kw">toupper</span>(Gender)) <span class="co"># для унификации заменяем все буквы на большие</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co"># а теперь как?</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11">good <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    38 obs. of  5 variables:
##  $ ID       : chr  &quot;PL01.It1&quot; &quot;PL01.It2&quot; &quot;PL01.It3&quot; &quot;PL01.It4&quot; ...
##  $ Weight   : num  44 99.2 22 67 91.8 95 13 51.1 57 97 ...
##  $ Species  : chr  &quot;Genus1 species1&quot; &quot;Genus1 species1&quot; &quot;Genus1 species1&quot; &quot;Genus1 species2&quot; ...
##  $ Num_ticks: num  203 0 70 0 197 0 125 229 138 218 ...
##  $ Gender   : chr  &quot;F&quot; &quot;M&quot; &quot;F&quot; &quot;M&quot; ...</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">good<span class="op">$</span>Species <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()</a></code></pre></div>
<pre><code>## [1] &quot;Genus1 species1&quot; &quot;Genus1 species2&quot; &quot;Genus1 sp&quot;       &quot;Genus1 sp.&quot;     
## [5] &quot;Genus1 spp.&quot;     NA                &quot;Genus2 species1&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">good<span class="op">$</span>Gender <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()</a></code></pre></div>
<pre><code>## [1] &quot;F&quot; &quot;M&quot; NA</code></pre>
<p>Здесь стоит отдельно остановиться на выражении <code>regex(&quot;(^na$)|(.*hz.*)|(.*\\?.*)&quot;, ignore_case = T)</code>. Речь идет об использовании регулярных выражений. Это способ указывать критерий для поиска или замен в строках. Простейший житейский пример регулярного выражения (правда, синтаксис там не очень правильный, зато понятный) - это когда мы выбираем файлы Excel выражением <code>*.xls(x)</code>.</p>
<p>Здесь я приведу один пример работы с ними: проверяем адреса электронной почты на правильность (это простенький пример, не претендующий на абсолютную правильность).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># поиск по паттерну</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">mails =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;good@mail1.ru&quot;</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">          <span class="st">&quot;good@mail2.ru&quot;</span>,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">          <span class="st">&quot;bad@mail@ru&quot;</span>,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">          <span class="st">&quot;another*bad@mail.ru&quot;</span>) <span class="co"># список адресов</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">mail_regex =<span class="st"> &quot;^[A-Za-z0-9.+_-]+@[A-Za-z0-9.+_-]+</span><span class="ch">\\</span><span class="st">.[A-Za-z0-9.+_-]{2,}$&quot;</span> <span class="co"># регулярное выражение</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="kw">str_detect</span>(mails, mail_regex) <span class="co"># проверяем адреса на соответствие выражению</span></a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE</code></pre>
<p>Разберем по частям</p>
<ul>
<li><code>^</code> в начале обозначает, что мы ищем с начала строки включительно, а <code>$</code> - что искомый элемент заканчивается концом строки; т.е. в итоге мы хотим чтобы строка полностью соответствовала шаблону, а не ее какая-то часть;</li>
<li><code>[A-Za-z0-9.+_-]</code> - это любой из символов в скобках, причем все большие буквы задаются диапазоном <code>A-Z</code>; аналогично задаются все маленькие и все цифры;</li>
<li><code>[A-Za-z0-9.+_-]+</code> - это вышеупомянутые символы, которые повторяются 1 и более раз (это указывается символом <code>+</code>; если может быть 0 и более раз, то используем символ <code>*</code>; чтобы в явном виде указать диапазон используем синтаксис <code>{min,max}</code>);</li>
<li><code>.</code> вне скобок обозначает любой символ, поэтому для обозначения точки нужно использовать сочетание <code>\\.</code>.</li>
</ul>
<p>Здесь я не буду подробнее останавливаться на регулярных выражениях, Вы можете подробнее прочитать про это по ссылкам далее [<a href="https://stringr.tidyverse.org/articles/regular-expressions.html">1</a>, <a href="https://github.com/rstudio/cheatsheets/blob/master/regex.pdf">2</a>, <a href="https://cran.r-project.org/web/packages/naniar/vignettes/replace-with-na.html">3</a>].</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/99_rhelp.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
